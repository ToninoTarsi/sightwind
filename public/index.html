<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Sightwind</title>

    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Raleway:700&amp;text=sightwind.">
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Roboto:400,500,700">
</head>
<body>

    <header class="header">
        <h1 class="header_logo">SightWind</h1>
        <ul class="header_nav">
            <li><a href="#" data-criterion="temp2m" class="is-temperature">Temperature</a></li>
            <li><a href="#" data-criterion="topo" class="is-topo">Topology</a></li>
            <li><a href="#" data-criterion="rain" class="is-rain">Rain</a></li>
            <li><a href="#" data-criterion="press" class="is-pressure">Pressure</a></li>
        </ul>
    </header>

    <div class="content">

        <div class="loading" id="loading-popup">
            <h3>
                Loading...
                <img src="data:image/gif;base64,R0lGODlhEAAQAPQAAP///wAAAPj4+Dg4OISEhAYGBiYmJtbW1qioqBYWFnZ2dmZmZuTk5JiYmMbGxkhISFZWVgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAAFUCAgjmRpnqUwFGwhKoRgqq2YFMaRGjWA8AbZiIBbjQQ8AmmFUJEQhQGJhaKOrCksgEla+KIkYvC6SJKQOISoNSYdeIk1ayA8ExTyeR3F749CACH5BAkKAAAALAAAAAAQABAAAAVoICCKR9KMaCoaxeCoqEAkRX3AwMHWxQIIjJSAZWgUEgzBwCBAEQpMwIDwY1FHgwJCtOW2UDWYIDyqNVVkUbYr6CK+o2eUMKgWrqKhj0FrEM8jQQALPFA3MAc8CQSAMA5ZBjgqDQmHIyEAIfkECQoAAAAsAAAAABAAEAAABWAgII4j85Ao2hRIKgrEUBQJLaSHMe8zgQo6Q8sxS7RIhILhBkgumCTZsXkACBC+0cwF2GoLLoFXREDcDlkAojBICRaFLDCOQtQKjmsQSubtDFU/NXcDBHwkaw1cKQ8MiyEAIfkECQoAAAAsAAAAABAAEAAABVIgII5kaZ6AIJQCMRTFQKiDQx4GrBfGa4uCnAEhQuRgPwCBtwK+kCNFgjh6QlFYgGO7baJ2CxIioSDpwqNggWCGDVVGphly3BkOpXDrKfNm/4AhACH5BAkKAAAALAAAAAAQABAAAAVgICCOZGmeqEAMRTEQwskYbV0Yx7kYSIzQhtgoBxCKBDQCIOcoLBimRiFhSABYU5gIgW01pLUBYkRItAYAqrlhYiwKjiWAcDMWY8QjsCf4DewiBzQ2N1AmKlgvgCiMjSQhACH5BAkKAAAALAAAAAAQABAAAAVfICCOZGmeqEgUxUAIpkA0AMKyxkEiSZEIsJqhYAg+boUFSTAkiBiNHks3sg1ILAfBiS10gyqCg0UaFBCkwy3RYKiIYMAC+RAxiQgYsJdAjw5DN2gILzEEZgVcKYuMJiEAOwAAAAAAAAAAAA==">
            </h3>
        </div>

        <div class="container">
            <svg></svg>
        </div>

        <footer class="footer">
            Forecast for <span id="time-text"></span><br>
            Open Data from the <a href="http://openmeteofoundation.org/">Open Meteo Foundation</a>
        </footer>

        <div class="detail">
            <h2 class="detail_coordinates">
                Lat: <span class="data_lat"></span>,
                Lon: <span class="data_lon"></span>
            </h2>
            <!-- <a href="#" class="detail_close">&#x00D7;</a> -->
            <hr class="detail_separator">
            <table class="detail_data">
                <tr>
                    <th>Wind speed <span class="unit">(km/h, 10m above ground)</span></th>
                    <td><span class="data_wind10m_speed"></span></td>
                </tr>
                <tr>
                    <th>Wind direction <span class="unit">(degrees from North)</span></th>
                    <td><span class="data_wind10m_dir"></span></td>
                </tr>
                <tr>
                    <th>Temperature <span class="unit">(Â°C)</span></th>
                    <td><span class="data_temp2m"></span></td>
                </tr>
                <tr>
                    <th>Rain <span class="unit">(mm/h)</span></th>
                    <td><span class="data_rain"></span></td>
                </tr>
                <tr>
                    <th>Altitude <span class="unit">(m)</span></th>
                    <td><span class="data_topo"></span></td>
                </tr>
                <tr>
                    <th>Pressure <span class="unit">(hPa)</span></th>
                    <td><span class="data_press"></span></td>
                </tr>
            </table>
        </div>

    </div>

    <script src="js/q.min.js"></script>
    <script src="js/three.min.js"></script>

    <script>

      var loadingText = document.getElementById("loading-text");
      var loadingPopup = document.getElementById("loading-popup");

      function init_error (msg) {
        loadingPopup.innerHTML="<h2>Error</h2>";
        loadingPopup.innerHTML+="<p>Your browser does not support "+msg+" technology. <a href=\"http://caniuse.com/#search="+msg+"\" target=\"_blank\">Learn more...</a></p>";
        loadingPopup.innerHTML+="<p>Please try with a modern browser such as Mozilla Firefox or Google Chrome.</p>";
      }

      var scripts_to_load=["js/d3.js", "js/topojson.v1.js", "js/main.js", "data/last.js"];

      function load_script() {
    var scriptname=scripts_to_load.shift();
    var script = document.createElement('script');
    script.onload=function () {
      if (scripts_to_load.length > 0) {
        load_script ();
        return;
      }
    };
        script.src=scriptname;
        document.body.appendChild(script);
      }

      (function(){

        var c = document.createElement('canvas');
        if (!(c.getContext && c.getContext('2d'))) {
          init_error('Canvas');
          return;
        }
        if (typeof Float32Array == "undefined") {
          init_error('Typed Arrays');
          return;
        }
        c.witdh=c.height=1;
        var ctx=c.getContext('2d');
        var id=ctx.getImageData(0,0, 1, 1);
        try {
      var test = new Float32Array(id.data.buffer);
        } catch (e) {
      init_error('Typed Arrays');
          return;
    }
        if (typeof requestAnimationFrame == "undefined") {
          init_error('requestAnimationFrame');
          return;
        }

        load_script();

      })();
    </script>

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-2529322-28', 'sightwind.com');
      ga('send', 'pageview');
    </script>







    <script type="x-shader/x-vertex" id="vertexshader">

            // switch on high precision floats
            #ifdef GL_ES
            precision highp float;
            #endif

            uniform float amplitude;
            attribute float displacement;
            attribute float positionX;
            attribute float positionY;
            varying vec3 vNormal;

            void main() {

                vNormal = normal;

                // multiply our displacement by the
                // amplitude. The amp will get animated
                // so we'll have animated displacement
                vec3 newPosition = position +
                                   normal *
                                   vec3(displacement *
                                        amplitude);

                gl_Position = projectionMatrix *
                              modelViewMatrix *
                              vec4(newPosition,1.0);
            }
        </script>

        <script type="x-shader/x-fragment" id="fragmentshader">

            #ifdef GL_ES
            precision highp float;
            #endif

            // same name and type as VS
            varying vec3 vNormal;

            void main() {

                // calc the dot product and clamp
                // 0 -> 1 rather than -1 -> 1
                vec3 light = vec3(0.5,0.2,1.0);

                // ensure it's normalized
                light = normalize(light);

                float dProd = max(0.0, dot(vNormal, light));

                // feed into our frag colour
                gl_FragColor = vec4(dProd, dProd, dProd, 1.0);

            }

        </script>



    <script type="text/javascript">

        // set the scene size
        var WIDTH = 1000,
            HEIGHT = 1000;

        // set some camera attributes
        var VIEW_ANGLE = 45,
            ASPECT = WIDTH / HEIGHT,
            NEAR = 1,
            FAR = 1000;

        // get the DOM element to attach to
        // - assume we've got jQuery to hand
        var $container = document.querySelector('.container');

        // create a WebGL renderer, camera
        // and a scene
        var renderer = new THREE.WebGLRenderer();
        var camera = new THREE.OrthographicCamera( WIDTH / -2, WIDTH / 2, HEIGHT / 2, HEIGHT / -2, 0, 1000);
        var scene = new THREE.Scene();

        // the camera starts at 0,0,0 so pull it back
        camera.position.z = 300;

        // start the renderer
        renderer.setSize(WIDTH, HEIGHT);

        // attach the render-supplied DOM element
        $container.appendChild(renderer.domElement);

        var attributes = {
            displacement: {
                type: 'f', // a float
                value: [] // an empty array
            },
            positionX: {
                type: 'f',
                value: [0.2, 0.5, 1, 2, 200]
            },
            positionY: {
                type: 'f',
                value: [0.2, 0.5, 1, 2, 200]
            }
        };

            var uniforms = {
                amplitude: {
                    type: 'f', // a float
                    value: 0
                }
            };

            // create the sphere's material
            var shaderMaterial = new THREE.ShaderMaterial({
                uniforms:       uniforms,
                attributes:     attributes,
                vertexShader:   document.querySelector('#vertexshader').innerHTML,
                fragmentShader: document.querySelector('#fragmentshader').innerHTML
            });

            // set up the sphere vars
            var radius = 50, segments = 16, rings = 16;

            // create a new mesh with sphere geometry -
            // we will cover the sphereMaterial next!
            var sphere = new THREE.Mesh(
               new THREE.SphereGeometry(radius, segments, rings),
               shaderMaterial);

            // now populate the array of attributes
            var vertices = sphere.geometry.vertices;
            var values = attributes.displacement.value
            for(var v = 0; v < vertices.length; v++) {
                values.push(Math.random() * 30);
            }

            // My geometry
            var geometry = new THREE.Geometry();

            for ( var i = 0; i < 100000; i++ ) {

                var vertex = new THREE.Vector3();
                vertex.x = Math.random() * 2 - 1;
                vertex.y = Math.random() * 2 - 1;
                vertex.z = Math.random() * 2 - 1;
                vertex.multiplyScalar( radius );

                geometry.vertices.push( vertex );

            }

            // add the sphere to the scene
            scene.add(sphere);

            var frame = 0;

            // draw!
            function update() {

                uniforms.amplitude.value = Math.sin(frame);
                frame += 0.1;

                renderer.render(scene, camera);

                // set up the next call
                requestAnimationFrame(update);
            }
            requestAnimationFrame(update);

    </script>

</body>
</html>